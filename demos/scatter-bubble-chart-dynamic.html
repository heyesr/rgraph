<!DOCTYPE html >
<html>
<head>
    <link rel="stylesheet" href="demos.css" type="text/css" media="screen" />
    <script src="../libraries/RGraph.common.core.js" ></script>
    <script src="../libraries/RGraph.scatter.js" ></script>
    <script src="demos.js" ></script>
    <meta name="robots" content="noindex, nofollow" />
</head>
<body>
    <h1>A dynamic Bubble chart interated with a range input</h1>

    <div id="rgraph-demo-html">
        <div style="text-align: center; font-size: 26pt; display: inline-block">
            <canvas id="cvs" width="900" height="350">[No canvas support]</canvas><br />
            <input type="range" min="2008" max="2022" value="2015" id="myRange" style="width: 900px" /><br />
            Year (2008-2022)
        </div>
    </div>
    
    <script>
        // Generate some data that can be shown on the chart.
        // This is not the final format that the Scatter
        // chart takes - that is handled in the draw() function
        // below.
        count         = 50;
        negativeDelta = -1;
        positiveDelta = 2;

        for (var i=2008,data=[],bubbleData=[],colors=['#DF555F','#DF55FF','lightblue','#ddd','pink','#6a6'];i<=2008; ++i) {

            data[i]       = [];
            bubbleData[i] = [];

            for (var j=0; j<count; ++j) {
                    
                var x = RGraph.random(1, 365);
                var y = ((x / 365) * 50) + RGraph.random(-10, 10);
                var z = RGraph.random(5, 40);
                var c = colors[RGraph.random(0, colors.length - 1)];

                data[i].push({x: x, y: y, color: c});
                bubbleData[i].push(z);
            }
        }

        // Now that the first years data (2008) has been generated
        // the following years data can be generated by slightly 
        // adding to or subtracting from it.
        for (var i=2009; i<=2022; ++i) {

            data[i]       = [];
            bubbleData[i] = [];

            for (var j=0; j<count; ++j) {
                    
                var x = data[i - 1][j].x+ RGraph.random(negativeDelta, positiveDelta);
                var y = data[i - 1][j].y + RGraph.random(negativeDelta, positiveDelta);
                var z = bubbleData[i - 1][j] + RGraph.random(negativeDelta, positiveDelta);
                var c = data[i - 1][j].color;

                data[i].push({x: x, y: y, color: c});
                bubbleData[i].push(z);
            }
        }


        // Add the event listener to the range input slider such
        // that when its updated the chart is redrawn.
        document.getElementById('myRange').addEventListener('input', function (e)
        {
            draw(Number(e.target.value));
        });


        // The draw function that draws the chart for the selected
        // year. This function parses the data into the correct
        // format for the Scatter chart and extracts the third
        // datapoint that becomes the size of the bubbles.
        function draw (year)
        {
            var points = [];

            // Parse the data and create the data for the chart
            for (var i=0; i<data[year].length; ++i) {
                points.push([
                    data[year][i].x,
                    Math.max(Math.min(data[year][i].y, 50), 0),
                    data[year][i].color
                ]);
            }

            // Reset the canvas
            RGraph.reset(document.getElementById('cvs'));
            

            // Create the Scatter chart and configure it as a
            // Bubble chart
            var scatter = new RGraph.Scatter({
                id: 'cvs',
                data: points,
                options: {
                    xaxisScaleMax: 365,
                    xaxisLabels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
                    textSize:14,
                    backgroundGrid: false,                
                    bubbleMin:0,
                    bubbleMax: 30,
                    bubbleWidth: 50,
                    bubbleData: bubbleData[year],
                    bubbleLinewidth: 2,
                    bubbleShadow: true,
                    bubbleShadowColor: 'black',
                    bubbleShadowBlur: 2,
                    bubbleShadowOffsetx: 1,
                    bubbleShadowOffsety: 1,
                    colorsBubbleStroke: 'gray',
                    textSize: 20,
                    textFont: 'Verdana',
                    textColor: 'gray',
                    yaxis: false,
                    yaxisScaleMax: 50,
                    marginLeft: 50
                }
            
            //
            // This beforedraw event draws the year in gray at
            // the back of the chart.
            }).on('beforedraw', function (obj)
            {
                RGraph.text({
                    object: obj,
                    text: year,
                    x: obj.canvas.width / 2,
                    y: obj.canvas.height / 2 + 20,
                    halign: 'center',
                    valign: 'center',
                    size: 250,
                    color: '#aaa'
                });
            }).draw();
        }
        
        // Initate the first draw of the chart
        draw(2015);
    </script>

    <p />

    <script>showSource()</script>

</body>
</html>